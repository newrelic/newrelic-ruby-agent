[{
  "name": "should respect record_sql policy",
  "required_features": ["record_sql"],
  "starting_policy_settings": {
    "record_sql": {"enabled": true}
  },
  "security_policies": {
    "record_sql":                     {"enabled": false, "required": false, "position": 0},
    "attributes_include":             {"enabled": true,  "required": false, "position": 1},
    "allow_raw_exception_messages":   {"enabled": true,  "required": false, "position": 2},
    "custom_events":                  {"enabled": true,  "required": false, "position": 3},
    "custom_parameters":              {"enabled": true,  "required": false, "position": 4},
    "custom_instrumentation_editor":  {"enabled": true,  "required": false, "position": 5},
    "message_parameters":             {"enabled": true,  "required": false, "position": 6},
    "job_arguments":                  {"enabled": true,  "required": false, "position": 7}
  },
  "expected_connect_policies": {
    "record_sql": {"enabled": false}
  },
  "validate_policies_not_in_connect": [],
  "ending_policy_settings": {
    "record_sql": {"enabled": false}
  },
  "should_log": false,
  "should_shutdown": false
}, {
  "name": "should respect attributes_include policy",
  "required_features": ["attributes_include"],
  "starting_policy_settings": {
    "attributes_include": {"enabled": true}
  },
  "security_policies": {
    "record_sql":                     {"enabled": true,  "required": false, "position": 0},
    "attributes_include":             {"enabled": false, "required": false, "position": 1},
    "allow_raw_exception_messages":   {"enabled": true,  "required": false, "position": 2},
    "custom_events":                  {"enabled": true,  "required": false, "position": 3},
    "custom_parameters":              {"enabled": true,  "required": false, "position": 4},
    "custom_instrumentation_editor":  {"enabled": true,  "required": false, "position": 5},
    "message_parameters":             {"enabled": true,  "required": false, "position": 6},
    "job_arguments":                  {"enabled": true,  "required": false, "position": 7}
  },
  "expected_connect_policies": {
    "attributes_include": {"enabled": false}
  },
  "validate_policies_not_in_connect": [],
  "ending_policy_settings": {
    "attributes_include": {"enabled": false}
  },
  "should_log": false,
  "should_shutdown": false
}, {
  "name": "should respect allow_raw_exception_messages policy and more secure local setting",
  "required_features": ["allow_raw_exception_messages"],
  "starting_policy_settings": {
    "allow_raw_exception_messages": {"enabled": true}
  },
  "security_policies": {
    "record_sql":                     {"enabled": true,  "required": false, "position": 0},
    "attributes_include":             {"enabled": true,  "required": false, "position": 1},
    "allow_raw_exception_messages":   {"enabled": false, "required": false, "position": 2},
    "custom_events":                  {"enabled": true,  "required": false, "position": 3},
    "custom_parameters":              {"enabled": true,  "required": false, "position": 4},
    "custom_instrumentation_editor":  {"enabled": true,  "required": false, "position": 5},
    "message_parameters":             {"enabled": true,  "required": false, "position": 6},
    "job_arguments":                  {"enabled": true,  "required": false, "position": 7}
  },
  "expected_connect_policies": {
    "allow_raw_exception_messages": {"enabled": false}
  },
  "validate_policies_not_in_connect": [],
  "ending_policy_settings": {
    "allow_raw_exception_messages": {"enabled": false}
  },
  "should_log": false,
  "should_shutdown": false
}, {
  "name": "should respect custom_events policy",
  "required_features": ["custom_events"],
  "starting_policy_settings": {
    "custom_events": {"enabled": true}
  },
  "security_policies": {
    "record_sql":                     {"enabled": true,  "required": false, "position": 0},
    "attributes_include":             {"enabled": true,  "required": false, "position": 1},
    "allow_raw_exception_messages":   {"enabled": true,  "required": false, "position": 2},
    "custom_events":                  {"enabled": false, "required": false, "position": 3},
    "custom_parameters":              {"enabled": true,  "required": false, "position": 4},
    "custom_instrumentation_editor":  {"enabled": true,  "required": false, "position": 5},
    "message_parameters":             {"enabled": true,  "required": false, "position": 6},
    "job_arguments":                  {"enabled": true,  "required": false, "position": 7}
  },
  "expected_connect_policies": {
    "custom_events": {"enabled": false}
  },
  "validate_policies_not_in_connect": [],
  "ending_policy_settings": {
    "custom_events": {"enabled": false}
  },
  "should_log": false,
  "should_shutdown": false
}, {
  "name": "should respect custom_parameters policy",
  "required_features": ["custom_parameters"],
  "starting_policy_settings": {
    "custom_parameters": {"enabled": true}
  },
  "security_policies": {
    "record_sql":                     {"enabled": true,  "required": false, "position": 0},
    "attributes_include":             {"enabled": true,  "required": false, "position": 1},
    "allow_raw_exception_messages":   {"enabled": true,  "required": false, "position": 2},
    "custom_events":                  {"enabled": true,  "required": false, "position": 3},
    "custom_parameters":              {"enabled": false, "required": false, "position": 4},
    "custom_instrumentation_editor":  {"enabled": true,  "required": false, "position": 5},
    "message_parameters":             {"enabled": true,  "required": false, "position": 6},
    "job_arguments":                  {"enabled": true,  "required": false, "position": 7}
  },
  "expected_connect_policies": {
    "custom_parameters": {"enabled": false}
  },
  "validate_policies_not_in_connect": [],
  "ending_policy_settings": {
    "custom_parameters": {"enabled": false}
  },
  "should_log": false,
  "should_shutdown": false
}, {
  "name": "should respect custom_instrumentation_editor policy",
  "required_features": ["custom_instrumentation_editor"],
  "starting_policy_settings": {
    "custom_instrumentation_editor": {"enabled": true}
  },
  "security_policies": {
    "record_sql":                     {"enabled": true,  "required": false, "position": 0},
    "attributes_include":             {"enabled": true,  "required": false, "position": 1},
    "allow_raw_exception_messages":   {"enabled": true,  "required": false, "position": 2},
    "custom_events":                  {"enabled": true,  "required": false, "position": 3},
    "custom_parameters":              {"enabled": true,  "required": false, "position": 4},
    "custom_instrumentation_editor":  {"enabled": false, "required": false, "position": 5},
    "message_parameters":             {"enabled": true,  "required": false, "position": 6},
    "job_arguments":                  {"enabled": true,  "required": false, "position": 7}
  },
  "expected_connect_policies": {
    "custom_instrumentation_editor": {"enabled": false}
  },
  "validate_policies_not_in_connect": [],
  "ending_policy_settings": {
    "custom_instrumentation_editor": {"enabled": false}
  },
  "should_log": false,
  "should_shutdown": false
}, {
  "name": "should respect message_parameters policy",
  "required_features": ["message_parameters"],
  "starting_policy_settings": {
    "message_parameters": {"enabled": true}
  },
  "security_policies": {
    "record_sql":                     {"enabled": true,  "required": false, "position": 0},
    "attributes_include":             {"enabled": true,  "required": false, "position": 1},
    "allow_raw_exception_messages":   {"enabled": true,  "required": false, "position": 2},
    "custom_events":                  {"enabled": true,  "required": false, "position": 3},
    "custom_parameters":              {"enabled": true,  "required": false, "position": 4},
    "custom_instrumentation_editor":  {"enabled": true,  "required": false, "position": 5},
    "message_parameters":             {"enabled": false, "required": false, "position": 6},
    "job_arguments":                  {"enabled": true,  "required": false, "position": 7}
  },
  "expected_connect_policies": {
    "message_parameters": {"enabled": false}
  },
  "validate_policies_not_in_connect": [],
  "ending_policy_settings": {
    "message_parameters": {"enabled": false}
  },
  "should_log": false,
  "should_shutdown": false
}, {
  "name": "should respect job_arguments policy",
  "required_features": ["job_arguments"],
  "starting_policy_settings": {
    "job_arguments": {"enabled": true}
  },
  "security_policies": {
    "record_sql":                     {"enabled": true,  "required": false, "position": 0},
    "attributes_include":             {"enabled": true,  "required": false, "position": 1},
    "allow_raw_exception_messages":   {"enabled": true,  "required": false, "position": 2},
    "custom_events":                  {"enabled": true,  "required": false, "position": 3},
    "custom_parameters":              {"enabled": true,  "required": false, "position": 4},
    "custom_instrumentation_editor":  {"enabled": true,  "required": false, "position": 5},
    "message_parameters":             {"enabled": true,  "required": false, "position": 6},
    "job_arguments":                  {"enabled": false, "required": false, "position": 7}
  },
  "expected_connect_policies": {
    "job_arguments": {"enabled": false}
  },
  "validate_policies_not_in_connect": [],
  "ending_policy_settings": {
    "job_arguments": {"enabled": false}
  },
  "should_log": false,
  "should_shutdown": false
}, {
  "name": "should fail because the agent knows about a policy the server does not",
  "required_features": ["record_sql"],
  "starting_policy_settings": {
    "record_sql": {"enabled": true}
  },
  "security_policies": {},
  "expected_connect_policies": {},
  "validate_policies_not_in_connect": [],
  "ending_policy_settings": {
    "record_sql": {"enabled": true}
  },
  "should_log": true,
  "should_shutdown": true
}, {
  "name": "should not respond with unknown policies",
  "required_features": ["record_sql"],
  "starting_policy_settings": {
    "record_sql": {"enabled": true}
  },
  "security_policies": {
    "record_sql":                     {"enabled": false, "required": false, "position": 0},
    "attributes_include":             {"enabled": true,  "required": false, "position": 1},
    "allow_raw_exception_messages":   {"enabled": true,  "required": false, "position": 2},
    "custom_events":                  {"enabled": true,  "required": false, "position": 3},
    "custom_parameters":              {"enabled": true,  "required": false, "position": 4},
    "custom_instrumentation_editor":  {"enabled": true,  "required": false, "position": 5},
    "message_parameters":             {"enabled": true,  "required": false, "position": 6},
    "job_arguments":                  {"enabled": true,  "required": false, "position": 7},
    "some_new_feature":               {"enabled": false, "required": false, "position": 8}
  },
  "expected_connect_policies": {
    "record_sql": {"enabled": false}
  },
  "validate_policies_not_in_connect": [
    "some_new_feature"
  ],
  "ending_policy_settings": {
    "record_sql": {"enabled": false}
  },
  "should_log": false,
  "should_shutdown": false
}, {
  "name": "should shutdown for required but unknown policies",
  "required_features": ["record_sql"],
  "starting_policy_settings": {
    "record_sql": {"enabled": true}
  },
  "security_policies": {
    "record_sql":                     {"enabled": false, "required": false, "position": 0},
    "attributes_include":             {"enabled": true,  "required": false, "position": 1},
    "allow_raw_exception_messages":   {"enabled": true,  "required": false, "position": 2},
    "custom_events":                  {"enabled": true,  "required": false, "position": 3},
    "custom_parameters":              {"enabled": true,  "required": false, "position": 4},
    "custom_instrumentation_editor":  {"enabled": true,  "required": false, "position": 5},
    "message_parameters":             {"enabled": true,  "required": false, "position": 6},
    "job_arguments":                  {"enabled": true,  "required": false, "position": 7},
    "some_new_feature":               {"enabled": false, "required": true,  "position": 8}
  },
  "expected_connect_policies": {
    "record_sql": {"enabled": false}
  },
  "validate_policies_not_in_connect": [],
  "ending_policy_settings": {
    "record_sql": {"enabled": false}
  },
  "should_log": true,
  "should_shutdown": true
}]
