# This file is distributed under New Relic's license terms.
# See https://github.com/newrelic/newrelic-ruby-agent/blob/main/LICENSE for complete details.
# frozen_string_literal: true

RAILS_VERSIONS = [
  [nil, 3.2],
  ['8.0.0', 3.2],
  ['7.2.0', 3.1],
  ['7.1.0', 2.7],
  ['7.0.0', 2.7],
  ['6.1.0'],
  ['6.0.0', 2.6, 2.7],
  ['5.2.0', 2.6, 2.6]
]

unshift_rails_edge(RAILS_VERSIONS)

def gem_list(rails_version = nil)
  # earlier thor errors, uncertain if they persist
  thor = "gem 'thor', '< 0.20.1'" if RUBY_PLATFORM == 'java' && rails_version && rails_version.include?('4')
  minitest_version = rails_version && rails_version.include?('4.0') ? '4.2.0' : '5.26.1'
  <<~RB
    gem 'rails'#{rails_version}
    gem 'haml', '~> 6.0'
    gem 'newrelic_prepender', path: File.expand_path('../newrelic_prepender', __FILE__)
    gem 'minitest', '~> #{minitest_version}'
    gem 'erubis', '~> 2.7.0' if RUBY_PLATFORM.eql?('java')
    #{thor}
    gem 'drb' if RUBY_VERSION >= '3.4.0'
    gem 'benchmark' if RUBY_VERSION >= '4.0.0'
  RB
end

create_gemfiles(RAILS_VERSIONS)
