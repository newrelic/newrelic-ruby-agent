# This file is distributed under New Relic's license terms.
# See https://github.com/newrelic/newrelic-ruby-agent/blob/main/LICENSE for complete details.
# frozen_string_literal: true

RAILS_VERSIONS = [
  [nil, 2.7],
  ['7.0.0', 2.7],
  ['6.1.0', 2.5],
  ['6.0.0', 2.5, 2.7],
  ['5.2.0', 2.4, 2.6],
  ['5.1.0', 2.4, 2.5],
  ['5.0.0', 2.4, 2.4],
  ['4.2.0', 2.4, 2.4]
]

unshift_rails_edge(RAILS_VERSIONS)

def gem_list(rails_version = nil)
  # earlier thor errors, uncertain if they persist
  thor = "gem 'thor', '< 0.20.1'" if RUBY_PLATFORM == 'java' && rails_version && rails_version.include?('4')
  minitest_version = rails_version && rails_version.include?('4.0') ? '4.2.0' : '5.2.3'
  <<~RB
    gem 'rails'#{rails_version}
    gem 'haml'
    gem 'newrelic_prepender', path: File.expand_path('../newrelic_prepender', __FILE__)
    gem 'minitest', '~> #{minitest_version}'
    gem 'erubis', '~> 2.7.0' if RUBY_PLATFORM.eql?('java')
    #{thor}
    gem 'loofah', '~> 2.20.0' if RUBY_VERSION >= '2.4.0' && RUBY_VERSION < '2.5.0'
  RB
end

create_gemfiles(RAILS_VERSIONS)
