name: Performance Tests

on:
  pull_request:
    # branches:
    #   - main
  # schedule:
  #   - cron:  '0 9 * * 0'
jobs:
  run_perf_tests:
    runs-on: ubuntu-22.04
    defaults:
      run:
        working-directory: ./test/performance
    steps:
      - uses: actions/checkout@v2
        with:
          ref: 'main'
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.1'
      - run: bundle
      - run: pwd
      - run: script/runner -B
      - uses: actions/checkout@v2
      - run: script/runner -C > performance_tests.txt
      - name: Save performance results
        uses: actions/upload-artifact@v3
        with:
          name: performance-test-results
          path: test/performance/performance_tests.txt
      - name: Upload to slack
        uses: adrey/slack-file-upload-action@master
        with:
          token: ${{ secrets.RUBY_GITHUB_ACTIONS_BOT_WEBHOOK }}
          path: test/performance/performance_tests.txt
          channel: hannah-private-testing-channel
